        if (jsonMatch) {
          return JSON.parse(jsonMatch[1]);
        }
        
        throw new Error(`Failed to parse AI response after ${maxRetries} attempts`);
      }
      
      // Wait before retry
      await new Promise(resolve => setTimeout(resolve, 1000 * attempt));
    }
  }
  
  throw new Error('Unexpected error in parseAIResponseWithRetry');
}
